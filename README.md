# Extracting-Phylogenies-from-Images-using-AI
Repository for my Bachelors thesis on the extraction of phylogenies from images using AI namely the OpenAI API.
## Structure 
The project contains 5 major steps for generating images, generating a response from an AI model and then comparing the actual newick string with the newick string generated by the model for quality control:
1. Generation of data (pair of newick string and image of the corresponding phylogenetic tree)
2. Newick encoding with AI model
3. Comparison of actual and generated Newick string
4. Summary of comparisons
5. Shell script for the complete pipeline

## 1. Generation of data
### Input
Arguments for whatever type of data is supposed to be generated (i.e. newicks with random distances and 10 taxa, newicks with fixed distances of one and a random amount of taxa between 2 and a specified amount, etc.)
### Output 
Directory containing a text file with the newick inside and an image file containing the corresponding phylogenetic tree 
### General idea
1. Depending on the given arguments generate a random amount of taxa between 2 and the specified maximum amount
2. Using the ETE toolkit and the NCBI taxonomy generate the newick tree from random taxon IDs   
3. Translate the taxon IDs to the actual taxa
4. If specified randomize the distances inside the newick tree using regex to edit the newick string
6. Draw the Newick tree using the draw function from Biopython
7. Save the drawn image using matplotlib
8. Put both image and text file containing newick tree into a directory inside the generated_data directory

## 2. Newick encoding with AI model
This part is made as its own module with the intention that the pipeline as a whole works with different models. This way different models can be used and their results can be compared easily.

### Input
Directory containing an image of the phylogenetic tree and a text file containing the newick string and one of these models: 
### Output
The input directory updated with a text file with the generated newick string  
### General idea
1. given one directory from the generated_data directory 
	- the user has to specify the path to this folder
2. the directory is looked into and the image (binary) saved into variables
3. the image has to be translated to base64 
4. the base64 image is given to the API and the answer is saved to a string 
5. the string is saved to the input directory as a text file called generated_newick with the same file ID as the input directory

## 3. Comparison of actual and generated Newick string 
### Input
Directory containing the image, actual and generated newick string 
### Output
The input directory updated with a comparison file that describes the differences between the actual and the generated newick for quality control 
### General idea
- now that we have a comparison file for each actual-newick/generated-newick  pair we need to sum up all results in one place and do statistics over how well the overall performance of our model was
	- count the number of correct newicks 
	- count the number of all newicks
	- count the number of mistakes in distances
	- count the number of mistakes in taxa

## 4. Summary of comparisons
### Input
Comparison files of each directory inside the specified generated_data directory
### Output
File with statistics over all comparisons to do a quality analysis of the model on whatever data was initially generated 
### General idea
- now that we have a comparison file for each actual-newick/generated-newick  pair we need to sum up all results in one place and do statistics over how well the overall performance of our model was
	- count the number of correct newicks 
	- count the number of all newicks
	- count the number of mistakes in distances
	- count the number of mistakes in taxa

## 5. Shell script for the complete pipeline
This script combines all aforementioned steps in one script. The purpose of this script is to precisely check the quality of the AI generated outputs 
### General idea
- calls data generation code, newick encoding code and the comparison code
1. calls the data generation code with arguments specified by the user
	- make arguments like "random distances with fixed amount of taxa (i.e. 10, 20, 30)", "fixed distances with random amount of taxa (max. 30)", "fixed distances, fixed amount of taxa", etc. with a specified amount of images to be generated for each argument 
2. iterates through all directories inside the specified generated_data directory
	- for every directory calls the newick encoding code so that newick string by GPT are generated for each folder
3. give the finished generated_data directory to the comparison code to generate a comparison file for each directory 
4. call comparison summary code on all directories and their comparison files
5. write all statistics over the comparisons in one file 
